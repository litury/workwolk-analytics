generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Пользователь с OAuth токенами HH.ru
model User {
  id           String    @id @default(uuid())
  hhUserId     String    @unique @map("hh_user_id")
  email        String?   @unique
  fullName     String?   @map("full_name")

  // OAuth токены HH.ru
  accessToken  String?   @map("access_token") @db.Text
  refreshToken String?   @map("refresh_token") @db.Text
  tokenExpiry  DateTime? @map("token_expiry")

  // Telegram опционально для будущей интеграции
  telegramId   BigInt?   @unique @map("telegram_id")

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  resumes      Resume[]
  applications Application[]

  @@map("users")
}

// Резюме пользователя из HH.ru
model Resume {
  id                 String   @id @default(uuid())
  hhResumeId         String   @unique @map("hh_resume_id")
  title              String
  autoRespondEnabled Boolean  @default(false) @map("auto_respond_enabled")

  userId             String   @map("user_id")
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  applications       Application[]

  @@index([userId])
  @@index([autoRespondEnabled])
  @@map("resumes")
}

// Отправленные отклики на вакансии
model Application {
  id           String   @id @default(uuid())

  resumeId     String   @map("resume_id")
  vacancyId    String   @map("vacancy_id")
  vacancyTitle String   @map("vacancy_title")
  userId       String   @map("user_id")

  status       String   @default("sent") // sent, viewed, invited, rejected, error
  appliedAt    DateTime @default(now()) @map("applied_at")

  resume       Resume   @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([resumeId, vacancyId])
  @@index([userId])
  @@index([appliedAt])
  @@index([status])
  @@map("applications")
}
